# マンデルブロ集合ビューア (Rust版)

M1 Mac (Apple Silicon) 対応の Rust 製高速インタラクティブ・マンデルブロ集合ビューア。

## 目次

- [マンデルブロ集合ビューア (Rust版)](#マンデルブロ集合ビューア-rust版)
  - [目次](#目次)
  - [特徴](#特徴)
  - [使い方](#使い方)
  - [バージョン比較](#バージョン比較)
  - [操作方法](#操作方法)
  - [動作イメージ](#動作イメージ)
    - [GPUハイブリッド版](#gpuハイブリッド版)
    - [CPUハイブリッド版](#cpuハイブリッド版)
  - [ウィンドウ構成](#ウィンドウ構成)
  - [ファイル構成](#ファイル構成)
  - [依存クレート](#依存クレート)
  - [パフォーマンス比較](#パフォーマンス比較)
  - [技術詳細](#技術詳細)
  - [ライセンス](#ライセンス)

## 特徴

- **🎮 GPUハイブリッド版** - ズームレベルに応じて3モード自動切替
  - 🎮 浅いズーム（〜×10^3）: GPU f32（超高速）
  - 🚀 中程度（×10^3〜×10^13）: CPU f64 + Rayon並列処理
  - 🔬 深いズーム（×10^13〜）: CPU rug任意精度（無限ズーム）
- **🚀 CPUハイブリッド版** - ズームレベルに応じて2モード自動切替
  - 🚀 浅いズーム（〜×10^13）: CPU f64 + Rayon並列処理
  - 🔬 深いズーム（×10^13〜）: CPU rug任意精度（無限ズーム）
- **📊 ウィンドウタイトルでモード表示** - 現在のモードとズームレベルをリアルタイム表示
- **🎨 Python版と同じカラーマップ** - 深い青→水色→クリーム→オレンジ→赤→黒
- **📊 カラーバー表示** - 反復回数のスケール（0〜256）を数値ラベル付きで右側に表示

## 使い方

```bash
# ビルド（初回のみ、GMPライブラリが必要）
brew install gmp
cargo build --release

# GPUハイブリッド版を実行（推奨）
cargo run --release --bin mandelbrot-gpu

# CPUハイブリッド版を実行
cargo run --release

# 高精度専用版を実行
cargo run --release --bin mandelbrot-hp
```

## バージョン比較

| バージョン | コマンド | モード | 用途 |
|-----------|---------|--------|------|
| **GPUハイブリッド版** | `--bin mandelbrot-gpu` | GPU → CPU → 高精度 | **推奨** |
| **CPUハイブリッド版** | `cargo run --release` | CPU → 高精度 | GPU非対応環境向け |
| **高精度専用版** | `--bin mandelbrot-hp` | 高精度のみ | デバッグ用 |

## 操作方法

| 操作 | 機能 |
|------|------|
| マウスホイール上 | ズームイン（0.8倍） |
| マウスホイール下 | ズームアウト（1.25倍） |
| 左クリック | クリック位置を画面中心に移動（パン） |
| 右クリック | クリック位置を中心にズームイン（0.8倍） |
| `R` キー | 初期表示にリセット |
| `S` キー | 現在の表示を画像として保存 |
| `Q` / `Escape` キー | 終了 |

## 動作イメージ

### GPUハイブリッド版

```text
GPU: Apple M1
ウィンドウタイトル: マンデルブロ集合 [GPU] x1.00e+00

モード切替: 🎮 GPU (f32) → 🚀 CPU (f64)
ウィンドウタイトル: マンデルブロ集合 [CPU] x1.50e+03

モード切替: 🚀 CPU (f64) → 🔬 高精度 (任意精度)
ウィンドウタイトル: マンデルブロ集合 [HP 256bit] x1.00e+14
```

### CPUハイブリッド版

```text
ウィンドウタイトル: マンデルブロ集合 [CPU] x1.00e+00

モード切替: 🚀 高速 (f64) → 🔬 高精度 (任意精度)
ウィンドウタイトル: マンデルブロ集合 [HP 256bit] x1.00e+14
```

## ウィンドウ構成

```text
+---------------------------+--------+
|                           |  256   |
|                           |   |    |
|   マンデルブロ描画領域    |  192   |
|      (800 x 600)          | カ|    |
|                           | ラ128  |
|   [高精度モード時は       | |バ    |
|    200x150を中央に描画]   | バ64   |
|                           | |ー    |
|                           |   0    |
+---------------------------+--------+
         860 x 600
```

## ファイル構成

```text
rust/
├── Cargo.toml                    # 依存関係
├── src/
│   ├── lib.rs                    # 共通ライブラリ
│   ├── common/                   # 共通モジュール
│   │   ├── mod.rs
│   │   ├── colors.rs             # カラーマップ、色変換関数
│   │   ├── constants.rs          # 共通定数
│   │   ├── font.rs               # フォント、描画関数
│   │   └── mandelbrot.rs         # マンデルブロ計算関数
│   ├── main.rs                   # CPUハイブリッド版
│   ├── main_gpu.rs               # GPUハイブリッド版
│   ├── main_highprecision.rs     # 高精度専用版
│   └── mandelbrot.wgsl           # GPUシェーダー
└── README.md
```

## 依存クレート

| クレート | 用途 |
|---------|------|
| `image` | 画像生成・保存（PNG形式） |
| `rayon` | 並列処理（CPU f64モード） |
| `num-complex` | 複素数演算（CPU f64モード） |
| `minifb` | ウィンドウ表示・入力処理 |
| `rug` | 任意精度演算（高精度モード、GMP/MPFR利用） |
| `wgpu` | GPU計算（Metal/Vulkan/DX12対応） |
| `pollster` | 非同期処理のブロッキング実行 |
| `bytemuck` | GPU↔CPU間のデータ転送 |

## パフォーマンス比較

| モード | 再描画時間 | 備考 |
|--------|----------|------|
| 🎮 GPU (f32) | **約0.3-0.5ms** | Metal compute shader |
| 🚀 CPU f64 (Rayon) | 約2-4ms | 800×600ピクセル、並列化 |
| 🔬 CPU 任意精度 | 数秒〜 | 200×150ピクセル、逐次計算 |

## 技術詳細

- **描画領域**: 800×600ピクセル（マンデルブロ集合）+ 60ピクセル（カラーバー）
- **高精度モード**: 200×150ピクセルで計算し、中央に表示（周囲は背景色で埋める）
- **反復回数**: 最大256回
- **モード切替閾値**:
  - GPUハイブリッド版: ×10^3で GPU → CPU、×10^13で CPU → 高精度
  - CPUハイブリッド版: ×10^13で CPU → 高精度
- **最大精度**: 4096ビット（必要に応じて自動拡張）

## ライセンス

MIT License
